<!DOCTYPE html><html lang="en"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Automating Poll Tweets in the New Layout Hellscape | Blog</title><meta name="description" content="Things i gone and done "><meta itemprop="name" content="Jonny Saunders"><meta itemprop="description" content="Things i gone and done "><meta itemprop="image" content="http://localhost:4000/blog/blog/assets/images/schillbot_header.png"><meta property="og:url" content="http://localhost:4000/blog/2019/07/23/Automating-Poll-Tweets-In-The-New-Layout-Hellscape/"><meta property="og:type" content="website"><meta property="og:title" content="Automating Poll Tweets in the New Layout Hellscape | Blog"><meta property="og:site_name" content="Blog"><meta property="og:description" content="Things i gone and done "><meta property="og:image" content="http://localhost:4000/blog/blog/assets/images/schillbot_header.png"><meta name="twitter:url" content="http://localhost:4000/blog/2019/07/23/Automating-Poll-Tweets-In-The-New-Layout-Hellscape/"><meta name="twitter:url" content=""><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Automating Poll Tweets in the New Layout Hellscape | Blog"><meta name="twitter:site" content="Blog"><meta name="twitter:description" content="Things i gone and done "><meta name="twitter:creator" content="@json_dirs"><meta property="twitter:image" content="http://localhost:4000/blog/blog/assets/images/schillbot_header.png"><link rel="icon" type="image/x-icon" href="/blog/assets/images/favicon.ico"><link rel="stylesheet" href="/blog/assets/css/app.min.css"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.0/dist/bootstrap-toc.min.css"> <script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.0/dist/bootstrap-toc.min.js"></script><style> .hljs{display:block;overflow-x:auto;padding:0.5em;background:#23241f}.hljs,.hljs-tag,.hljs-subst{color:#f8f8f2}.hljs-strong,.hljs-emphasis{color:#a8a8a2}.hljs-bullet,.hljs-quote,.hljs-number,.hljs-regexp,.hljs-literal,.hljs-link{color:#ae81ff}.hljs-code,.hljs-title,.hljs-section,.hljs-selector-class{color:#a6e22e}.hljs-strong{font-weight:bold}.hljs-emphasis{font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-name,.hljs-attr{color:#f92672}.hljs-symbol,.hljs-attribute{color:#66d9ef}.hljs-params,.hljs-class .hljs-title{color:#f8f8f2}.hljs-string,.hljs-type,.hljs-built_in,.hljs-builtin-name,.hljs-selector-id,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-addition,.hljs-variable,.hljs-template-variable{color:#e6db74}.hljs-comment,.hljs-deletion,.hljs-meta{color:#75715e}</style><script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.13.1/build/highlight.min.js"></script> <script>hljs.initHighlightingOnLoad();</script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-127799940-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-127799940-1'); </script><link rel="alternate" type="application/rss+xml" title="Blog" href="/blog/feed.xml"><link rel="canonical" href="/blog/2019/07/23/Automating-Poll-Tweets-In-The-New-Layout-Hellscape/"></head><body id="automating-poll-tweets-in-the-new-layout-hellscape" class="post-layout"><header class="header"> <a class="header__title" href="http://localhost:4000/blog/">Blog</a><nav><ul class="header__list"><li><a href="/blog/">Stories</a></li><li><span class="popup__open">Contact</span></li></ul></nav></header><main class="ðŸ’ˆ"><div class="post"><article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting"><div class="post__header section-padding--double"><div class="grid-small"><h2 itemprop="name headline">Automating Poll Tweets in the New Layout Hellscape</h2><time class="post__date" datetime="2019-07-23T00:00:00-07:00" itemprop="datePublished">23 Jul 2019</time></div></div><div class="post__img"><div><figure class="absolute-bg" style="background-image: url('/blog/assets/images/schillbot_header.png');"></figure></div></div><div class="container"><div class="row"><div class="col-md-3 hidden-sm"><div class="sticky-top"></div></div><div class="col-md-9 col-sm-12 post__content section-padding" id="markdown" itemprop="articleBody"><p>Yes, the new Twitter layout is so o o bad, but it also broke my bot that uses Selenium to post polls (a weird missing part of the Twitter API).</p><p>Here are some new selectors that should be useful.</p><p>While Iâ€™m at it, Iâ€™ll explain a few pieces of rest of this slightly-trickier-than-usual bot. (Iâ€™m sure I borrowed most of this code from somewhere but I canâ€™t remember where :(, sorry knowledge hole.)</p><p><a href="https://github.com/sneakers-the-rat/schillbot">See the full repo</a></p><p>Your bot will do this:</p><video controls=""> <source src="/blog/assets/images/schillbot_vid.mp4" type="video/mp4" /> </video><h1 id="imports">Imports</h1><p>This uses selenium and a few other standards, hereâ€™s all them parts</p><pre><code class="python">
import logging
import os
import random
import time
import traceback
import json

import pandas as pd
import numpy as np

from selenium import webdriver
from selenium.common.exceptions import StaleElementReferenceException, TimeoutException
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.common.by import By
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.support.wait import WebDriverWait
</code></pre><h1 id="parameter-classes">Parameter classes</h1><p>A few classes to hold our parameters. The primary class here is <code class="highlighter-rouge">TwitterLocator</code>. To manipulate the web zone you need to know what to click on, what to scroll to, heck even what to type in. We use seleniumâ€™s <code class="highlighter-rouge">By</code> module and make tuples for each as class attributes. Some of these were pretty heinous to find after the homepage update, so theyâ€™ll probably change next week and ymmv.</p><pre><code class="python">

class URL:
    TWITTER = 'http://twitter.com'

class Constants:
    USERNAME = creds['USER']
    PASSWORD = creds['PASS']
    GLOBAL_ENTRY_Q = '#globalentry'


class TwitterLocator:
    # login stuff
    login_btn        = (By.CLASS_NAME, "StaticLoggedOutHomePage-buttonLogin")
    username         = (By.CLASS_NAME, "js-username-field")
    password         = (By.CLASS_NAME, "js-password-field")

    # tweet stuff
    outer_tweet_box  = (By.CLASS_NAME, 'public-DraftStyleDefault-block')
    tweet_box        = (By.CLASS_NAME, "public-DraftEditor-content")
    tweet_btn        = (By.XPATH, "//*[@data-testid='toolBar']//div[2]//div[3]")

    # poll stuff
    poll_btn         = (By.XPATH, '//div[@aria-label="Add poll"]')
    option_one       = (By.NAME, 'Choice1')
    option_two       = (By.NAME, 'Choice2')

    # etc.
    search_input     = (By.ID, "search-query")
    like_btn         = (By.CLASS_NAME, "HeartAnimation")
    latest_tweets    = (By.PARTIAL_LINK_TEXT, 'Latest')

</code></pre><h1 id="pollbot-itself">PollBot itself</h1><p>It starts innocently enough, loading a basic <a href="http://chromedriver.chromium.org/downloads">Chrome webdriver</a> and loading the homepage. Youâ€™ll have to add your chromedriver to your path, eg. <code class="highlighter-rouge">export PATH=$PATH:/path/to/chromedriver/folder</code>. Uncomment the â€˜â€“headlessâ€™ line if you donâ€™t want it popping up on you.</p><pre><code class="python">

class PollBot(object):

    def __init__(self):
        self.locator_dictionary = TwitterLocator.__dict__
        self.chrome_options = Options()
        #self.chrome_options.add_argument("--headless")
        self.browser = webdriver.Chrome(chrome_options=self.chrome_options)
        self.browser.get(URL.TWITTER)
        self.timeout = 2
        
</code></pre><p>The guts of the class uses the <code class="highlighter-rouge">TwitterLocator</code> class to navigate the site by overloading the <code class="highlighter-rouge">__getattr__</code>. We use a few <code class="highlighter-rouge">WebDriverWait</code>s to make sure the thing weâ€™re looking for is on the page, and then <code class="highlighter-rouge">find_element</code></p><pre><code class="python">

    def _find_element(self, *loc):
        return self.browser.find_element(*loc)

    def __getattr__(self, what):
        try:
            if what in self.locator_dictionary.keys():
                try:
                    element = WebDriverWait(self.browser, self.timeout).until(
                        EC.presence_of_element_located(self.locator_dictionary[what])
                    )
                except(TimeoutException, StaleElementReferenceException):
                    traceback.print_exc()

                try:
                    element = WebDriverWait(self.browser, self.timeout).until(
                        EC.visibility_of_element_located(self.locator_dictionary[what])
                    )
                except(TimeoutException, StaleElementReferenceException):
                    traceback.print_exc()
                # I could have returned element, however because of lazy loading, I am seeking the element before return
                return self._find_element(*self.locator_dictionary[what])
        except AttributeError:
            super(PollBot, self).__getattribute__("method_missing")(what)
</code></pre><p>Weâ€™ll chain together two methods and I guess quit too.</p><pre><code class="python">
    def run(self, post_text):
        self.login()
        self.tweet_poll(post_text)
        self.browser.quit()
</code></pre><h2 id="login">Login</h2><p>So when we do things like <code class="highlighter-rouge">.login()</code> we just chain together a bunch of attribute calls - calling <code class="highlighter-rouge">self.login_btn</code> calls <code class="highlighter-rouge">self.__getattr__(self, 'login_btn')</code> - and selenium commands. We get pretty sleepy through all these methods because this bot doesnâ€™t care about FAST POSTS and has bad internet.</p><pre><code class="python">

    def login(self, username=Constants.USERNAME, password=Constants.PASSWORD):
        self.login_btn.click()
        time.sleep(1)
        self.username.click()
        time.sleep(0.1)
        self.username.send_keys(username)
        time.sleep(0.1)
        self.password.click()
        time.sleep(0.1)
        self.password.send_keys(password)
        time.sleep(0.1)
        self.browser.find_elements_by_css_selector(".clearfix&gt;.submit")[0].click()
        time.sleep(0.5)

</code></pre><h2 id="tweet-poll">Tweet poll</h2><p>Once weâ€™re logged in, go ahead and tweet the poll already. More of the same song and dance.</p><pre><code class="python">

    def tweet_poll(self, post_text):

        # click the tweet box
        self.outer_tweet_box.click()
        time.sleep(1)

        # type the tweet
        self.tweet_box.send_keys('\"' + post_text.lower() + '\" uohellno.com')
        time.sleep(1)

        # make the poll
        self.poll_btn.click()
        time.sleep(0.1)
        self.option_one.click()
        time.sleep(0.1)
        self.option_one.send_keys('human schill')
        time.sleep(0.1)
        self.option_two.click()
        time.sleep(0.1)
        self.option_two.send_keys('robot schill')
        time.sleep(0.2)

        # send the tweet
        self.tweet_btn.click()
        time.sleep(2)

</code></pre><h1 id="fin">fin</h1><p>And there you have it. The rest of the code in the repo is just badly made code to randomly choose a tweet from some <a href="https://twitter.com/schillbot3000">neural net that mocks the President of the University of Oregon</a>.</p></div></div><div class="row"><ul class="post__social"><li><a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/blog/2019/07/23/Automating-Poll-Tweets-In-The-New-Layout-Hellscape/" target="_blank"><i class="fa fa-facebook"></i></a></li><li><a href="https://twitter.com/intent/tweet?&text=Automating Poll Tweets in the New Layout Hellscape+http://localhost:4000/blog/2019/07/23/Automating-Poll-Tweets-In-The-New-Layout-Hellscape/+by+Jonny Saunders" target="_blank"><i class="fa fa-twitter"></i></a></li><li><a href="https://plus.google.com/share?url=http://localhost:4000/blog/2019/07/23/Automating-Poll-Tweets-In-The-New-Layout-Hellscape/" target="_blank"><i class="fa fa-google-plus"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?mini=true&source=Automating Poll Tweets in the New Layout Hellscape&summary=&url=http://localhost:4000/blog/2019/07/23/Automating-Poll-Tweets-In-The-New-Layout-Hellscape/" target="_blank"><i class="fa fa-linkedin"></i></a></li><li><a href="https://www.stumbleupon.com/badge/?url=http://localhost:4000/blog/2019/07/23/Automating-Poll-Tweets-In-The-New-Layout-Hellscape/" target="_blank"><i class="fa fa-stumbleupon"></i></a></li><li><a href="https://www.reddit.com/submit?url=http://localhost:4000/blog/2019/07/23/Automating-Poll-Tweets-In-The-New-Layout-Hellscape/" target="_blank"><i class="fa fa-reddit-alien"></i></a></li><li><a href="https://www.tumblr.com/share/link?url=http://localhost:4000/blog/2019/07/23/Automating-Poll-Tweets-In-The-New-Layout-Hellscape/" target="_blank"><i class="fa fa-tumblr"></i></a></li><li><a href="https://www.pinterest.com/pin/create/link/?description=&media=http://localhost:4000/blog/blog/assets/images/schillbot_header.png&url=http://localhost:4000/blog/2019/07/23/Automating-Poll-Tweets-In-The-New-Layout-Hellscape/" target="_blank"><i class="fa fa-pinterest"></i></a></li></ul></div></div><div class="section-padding--none"><div class="grid"><hr class="sep"/></div></div><div class="section-padding"><div class="grid-small"> <span class="post__author">Posted by <a href="http://jon-e.net" title="More By Jonny Saunders">Jonny Saunders</a></span><p class="post__bio">bad at programming and neuroscience in beautiful Oregon.</p></div></div></article></div><section class="related section-padding"><div class="grid-xlarge"><h2 class="related__title">Related</h2><div class="related__container"><article class="related__post"> <a class="related__link" href="http://localhost:4000/blog/2019/07/23/Automating-Poll-Tweets-In-The-New-Layout-Hellscape/"><figure class="related__img"> <img src="/blog/assets/images/schillbot_header.png" alt="Automating Poll Tweets in the New Layout Hellscape"/></figure><div><h2 class="related__text">Automating Poll Tweets in the New Layout Hellscape</h2></div></a></article></div></div></section></main><footer class="footer section-padding"><div class="grid"><div class="subscribe" id="subscribe"><div class="subscribe__container"> <span class="subscribe__title">Subscribe</span><p class="subscribe__text">Get a weekly email of posts Iâ€™ve added to the site.</p><form method="POST" action="&amp;c=?" id="mc-signup" name="mc-embedded-subscribe-form" novalidate><div style="position: absolute; left: -5000px;" aria-hidden="true"> <input type="text" name="" tabindex="-1" value=""></div><div class="form-group"> <input id="mce-EMAIL" type="email" name="EMAIL" placeholder="Email Address"></div><div class="form__btn"> <input id="mc-submit" type="submit" value="Sign Up" name="subscribe"></div></form><p class="subscribe__error hidden"></p></div></div><hr class="sep--white"/><div class="footer__container"><ul class="footer__tags"><li><a class="footer__link" href="/tag/science">Science</a></li><li><a class="footer__link" href="/tag/art">Art</a></li><li><a class="footer__link" href="/tag/arduino">Arduino</a></li><li><a class="footer__link" href="/tag/physical-art">Physical Art</a></li><li><a class="footer__link" href="/tag/light">Light</a></li></ul><ul class="footer__social"><li><a href="https://twitter.com/json_dirs" target="_blank"><i class="fa fa-twitter"></i></a></li><li><a href="https://github.com/sneakers_the_rat" target="_blank"><i class="fa fa-github"></i></a></li></ul></div></div></footer><section class="contact popup"><div class="popup__close"><div class="popup__exit"></div></div><div class="contact__container popup__container"><div class="contact__img"><figure class="absolute-bg" style="background-image: url(/blog/assets/images/profpic.jpg);"></figure></div><div class="contact__content"><div class="contact__mast section-padding--half"><div class="grid"><h2>Contact</h2></div></div><div class="section-padding--none"><hr class="sep"/></div><div class="contact__form section-padding--half"><div class="grid-xlarge"> <form id="form" class="form" action="https://formcarry.com/s/x7yoFO6sk0n" method="POST"><div class="form__subcontainer"><div> <label for="form-first-name">First Name</label> <input type="text" name="first-name" id="form-first-name" required></div><div> <label for="form-last-name">Last Name</label> <input type="text" name="last-name" id="form-last-name" required></div></div><div> <label for="form-email">E-Mail</label> <input type="email" name="email" id="form-email" required></div><div> <label for="form-message">Message</label> <textarea name="message" id="form-message" rows="3"></textarea></div><div class="form__submit"><div class="form__btn"> <input type="submit" value="Send"></div></div><p class="form__message"></p></form></div></div></div></div></section><script src="/blog/assets/js/app.min.js"></script></body></html>
  