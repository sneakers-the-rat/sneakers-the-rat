<!DOCTYPE html><html lang="en"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Northern Lights | Blog</title><meta name="description" content="Things i gone and done "><meta itemprop="name" content="Jonny Saunders"><meta itemprop="description" content="Things i gone and done "><meta itemprop="image" content="https://jon-e.net/blog/assets/images/nlight.png"><meta property="og:url" content="https://jon-e.net/blog/https://jon-e.net/blog/2018/10/18/northern-lights/"><meta property="og:type" content="website"><meta property="og:title" content="Northern Lights | Blog"><meta property="og:site_name" content="Blog"><meta property="og:description" content="Things i gone and done "><meta property="og:image" content="https://jon-e.net/blog/assets/images/nlight.png"><meta name="twitter:url" content="https://jon-e.net/blog/https://jon-e.net/blog/2018/10/18/northern-lights/"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Northern Lights | Blog"><meta name="twitter:site" content="Blog"><meta name="twitter:description" content="Things i gone and done "><meta name="twitter:creator" content="@json_dirs"><meta property="twitter:image" content="https://jon-e.net/blog/assets/images/nlight.png"><link rel="icon" type="image/x-icon" href="https://jon-e.net/blog/assets/images/favicon.ico"><link rel="stylesheet" href="https://jon-e.net/blog/assets/css/app.min.css"><style> .hljs{display:block;overflow-x:auto;padding:0.5em;background:#23241f}.hljs,.hljs-tag,.hljs-subst{color:#f8f8f2}.hljs-strong,.hljs-emphasis{color:#a8a8a2}.hljs-bullet,.hljs-quote,.hljs-number,.hljs-regexp,.hljs-literal,.hljs-link{color:#ae81ff}.hljs-code,.hljs-title,.hljs-section,.hljs-selector-class{color:#a6e22e}.hljs-strong{font-weight:bold}.hljs-emphasis{font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-name,.hljs-attr{color:#f92672}.hljs-symbol,.hljs-attribute{color:#66d9ef}.hljs-params,.hljs-class .hljs-title{color:#f8f8f2}.hljs-string,.hljs-type,.hljs-built_in,.hljs-builtin-name,.hljs-selector-id,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-addition,.hljs-variable,.hljs-template-variable{color:#e6db74}.hljs-comment,.hljs-deletion,.hljs-meta{color:#75715e}</style><script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.13.1/build/highlight.min.js"></script> <script>hljs.initHighlightingOnLoad();</script><link rel="alternate" type="application/rss+xml" title="Blog" href="https://jon-e.net/blog/feed.xml"><link rel="canonical" href="https://jon-e.net/blog/2018/10/18/northern-lights/"></head><body id="northern-lights" class="post-layout"><header class="header"> <a class="header__title" href="https://jon-e.net/blog/https://jon-e.net/blog/">Blog</a><nav><ul class="header__list"><li><a href="https://jon-e.net/blog/">Stories</a></li><li><a href="https://jon-e.net/blog/style-guide">Style Guide</a></li><li><span class="popup__open">Contact</span></li></ul></nav></header><main class="ðŸ’ˆ"><div class="post"><article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting"><div class="post__header section-padding--double"><div class="grid-small"><h2 itemprop="name headline">Northern Lights</h2><time class="post__date" datetime="2018-10-18T00:00:00-07:00" itemprop="datePublished">18 Oct 2018</time></div></div><div class="post__img"><div><figure class="absolute-bg" style="background-image: url('https://jon-e.net/blog/assets/images/nlight.png');"></figure></div></div><div class="post__content section-padding"><div class="grid"><div id="markdown" itemprop="articleBody"><style> body { background-color: black; color: #F5F5F5; } .header { background-color: #00000090; color: #F0F0F0; } .header__title { color: #F0F0F0; } .header__list a, .header__list span{ color: #F0F0F0; } a:link, a:hover, a:active,{ color: #F50000; } a:visited{ color: #0000FF; } .posts__link, .related__link { display: block; color: #FF0000; }</style><p>I needed to build the northern lights in my kitchen. (localized entirely within my kitchen).</p><p>They look like this:</p><video controls=""> <source src="/blog/assets/images/nlights.mp4" type="video/mp4" /> </video><p>And they also twinkle:</p><video controls=""> <source src="/blog/assets/images/twinkle.mp4" type="video/mp4" /> </video><p>They only turn on rarely because they are magic, but if you need them on to feel the close glow of the north pole you can enter the secret codeâ€¦</p><video controls=""> <source src="/blog/assets/images/onoff.mp4" type="video/mp4" /> </video><h1 id="ingredients">Ingredients</h1><table><thead><tr><th>Object</th><th>Link</th></tr></thead><tbody><tr><td>LED Strips</td><td><a href="https://www.aliexpress.com/item/WS2811-IC-Strip-Vedio-show-addressable-individually-ip30-or-waterproof-ip67-5050-RGB-SMD-30/32624331128.html?spm=a2g0s.9042311.0.0.77624c4dozuwtS">get some leds</a></td></tr><tr><td>LED Stands (3d mesh)</td><td><a href="https://jon-e.net/blog/assets/hosted/fat_led_stand.stl">download an stl</a></td></tr><tr><td>Arduino Uno</td><td><a href="https://store.arduino.cc/usa/arduino-uno-rev3">arduinos here</a></td></tr><tr><td>Photodiode</td><td><a href="https://www.digikey.com/products/en/sensors-transducers/optical-sensors-photodiodes/543">idk found in the lab try digikey</a></td></tr><tr><td>12V 3A DC Power Supply</td><td>Â </td></tr><tr><td>200 Ohm Resistor</td><td>Â </td></tr></tbody></table><h1 id="makin-it">Makin it</h1><p>is simple.</p><h2 id="step-1-board-of-leds">Step 1: Board of LEDs</h2><p><em>Print a bunch of these <a href="https://jon-e.net/blog/assets/hosted/fat_led_stand.stl">little stands</a></em></p><p><img src="https://jon-e.net/blog/assets/images/led_stand.png" alt="led stand" /></p><blockquote><p><em>moody as your mahogany past</em></p></blockquote><p>and glue them onto a board thusly</p><p><img src="https://jon-e.net/blog/assets/images/led_build_1.jpg" alt="glued to board" /></p><h2 id="step-2-wire-it-up">Step 2: Wire it up</h2><p>Like this. You need to 1) Power the LEDs, in my case with 12V and 3A split between 3 banks of 66 lights. 2) wire the DMX input lines to the arduino through some resistors and 3) attach a photodiode to sense when it gets dark. I used a 4.7kOhm resistor to get the photodiode in the luminance range of my kitchen, this will vary depending on your diode and ambient lighting conditions.</p><p><img src="https://jon-e.net/blog/assets/images/led_build_circuit.png" alt="yeah like this i said" /></p><p>Do not do as I do, and behold this as a warning. This style of circuit is built to cause fires and generate solder fumes. I epoxied over the exposed solder and wire to avoid dust combustion. Disregard the capacitor, it proved to explode.</p><p><img src="https://jon-e.net/blog/assets/images/led_build_wired.jpg" alt="disregard this" /></p><h2 id="step-3-code">Step 3: Code</h2><p>I stole a lot of this, hopefully I attributed as I went because I do not remember where it came from now. You will need the <a href="http://fastled.io">FastLED library</a>.</p><p>The idea is that we want to turn the lights on when the ambient light gets below a certain level. Except we donâ€™t want to just turn on, that would be too plain. Instead, we pick a random delay up to an hour and wait to turn on. We want to catch the northern lights by chance.</p><p>But if you canâ€™t wait for luck, you make your own. Flicking the light on and off three times will trigger the light.</p><p>Right now there are two modes, the northern lights, and twinkling. One picks a max value/saturation color in HSV space and fades its neighbors towards it. The other twinkles white lights. Who knows which is which. Each time the light turns on it picks a program at random.</p><pre><code class="c">
#include <FastLED.h>

#define NUM_STRIPS 3
#define NUM_PER_STRIP 22
#define NUM_LEDS NUM_STRIPS*NUM_PER_STRIP

// led array
CRGB leds[NUM_LEDS];

// https://learn.adafruit.com/photocells/arduino-code
int photocellPin = 0;     // the cell and 10K pulldown are connected to a0
int photocellReading;     // the analog reading from the sensor divider
#define DATA_PIN_1 2
#define DATA_PIN_2 3
#define DATA_PIN_3 4

// array to hold times since last light flick
// initialize to above threshold so we don't autostart the first time
long codetimes[3] = {10000, 10000, 10000};

// some logic variables to tell what state we're in.
// it's crude but it works damn it
bool ison;                // are the LEDs on?
bool isdark;              // did it go dark?
int program=1;            // which program are we running?
unsigned long wentdark=0; // did we just go dark?
long waittime;            // how long should we wait to turn the lights on?
unsigned long ontime;     // how long should the lights stay on?
long darktime;            // how long was it dark?

// idiosyncratic lighting variables
int lightthresh=200;
int flicklength=5000;
int framedelay=30;


void loop() {
  photocellReading = analogRead(photocellPin);
  //Serial.print("Analog reading = ");
  //Serial.println(photocellReading);     // the raw analog reading

  if (photocellReading &gt; lightthresh){
    // if we're just getting light, turn the lights off.
    if (isdark == true){
      for(int i=0; i&lt;NUM_LEDS; i++){
        leds[i] = CRGB(0, 0, 0);

      }
      LEDS.setBrightness(0);
      LEDS.show();
      isdark = false;
      ison = false;

      // stash the code
      // record the length of time that the light was off
      codetimes[0] = codetimes[1];
      codetimes[1] = codetimes[2];

      darktime = millis()-wentdark;
      codetimes[2] = darktime;
    }
    return;
  } else {
    if (isdark == false){
      // when it first gets dark...
      // pick a program
      if (random8()&lt;128){
        program = 1;
      } else {
        program = 2;
      }

      // get time off
      wentdark = millis();

      // if we are getting manually turned on, the wait time is zero
      if (codetimes[2] &lt; flicklength &amp;&amp; codetimes[1] &lt; flicklength){
        waittime = 0;
      } else {
        // otherwise get delay between now and an hour
        waittime = random(0, 3600000);
      }

      // turn the lights on
      isdark = true;
      ison = false;
    }

    if (millis()&lt;wentdark || millis()&lt;ontime){
      // arduino clock flipped back to zero
      wentdark = 0;
      ontime = 0;
    }


    if (ison == false &amp;&amp; (millis()-wentdark)&gt;waittime){
      // we're just turning on of our own accord
      // pick a program
      if (random8()&lt;128){
        program = 1;
      } else {
        program = 2;
      }

      // when did we go on? how long will we go?
      ontime = millis();
      waittime = random(600000, 3600000);

      // if we have waited long enough...
      LEDS.setBrightness(255);
      ison = true;

    }


    // if the light turns back on turn off.
    if (ison == true &amp;&amp; (millis()-ontime)&gt;waittime){
      for(int i=0; i&lt;NUM_LEDS; i++){
        leds[i] = CRGB(0, 0, 0);

      }
      LEDS.setBrightness(0);
      LEDS.show();
      wentdark = millis();
      waittime = random(600000, 3600000);
      //waittime = 5000;
      LEDS.setBrightness(0);
      ison = false;
    }


    // finally if we're on, do the thing.
    if (ison == true){
      if (program == 1){
        northernLights(leds);
      } else {
        twinkle(leds);
      }
    }


    LEDS.show();
  }


  delay(framedelay);


}


void setup() {
  // init values
  ison = false;
  isdark = false;

  random16_set_seed(8934);
  random16_add_entropy(analogRead(3));

  // start up serial if ya want it
  //Serial.begin(9600);
  //Serial.println("resetting!");

  // setup leds
  delay(1000);
  LEDS.addLeds&lt;WS2811,DATA_PIN_1,BRG&gt;(leds,0, NUM_PER_STRIP);
  LEDS.addLeds&lt;WS2811,DATA_PIN_2,BRG&gt;(leds,NUM_PER_STRIP, NUM_PER_STRIP);
  LEDS.addLeds&lt;WS2811,DATA_PIN_3,BRG&gt;(leds,NUM_PER_STRIP*2,NUM_PER_STRIP);
  LEDS.setBrightness(255);

  for(int i=0; i&lt;NUM_LEDS; i++){
        leds[i] = CRGB(0, 0, 0);

  }
  LEDS.setBrightness(0);
  LEDS.show();
}



void northernLights(CRGB* leds){
  for(int i=0; i&lt;NUM_LEDS; i++){

    if (i == NUM_LEDS-1) {
      fadeTowardColor(leds[i],leds[i-1],5);
    }
    else if (i==0){
      fadeTowardColor(leds[i],leds[i+1],5);
    }
    else{
      fadeTowardColor(leds[i],(leds[i+1]+leds[i-1])/2,5);
    }

    if(random16()&lt;40){
        CRGB color = CHSV( random8(), 255, 255);
        fadeTowardColor(leds[i], color, 255);
  }
  //leds[i] %= 225;
  }
  //delay(30);
}

void twinkle(CRGB* leds){
  for(int i=0; i&lt;NUM_LEDS; i++){

    fadeTowardColor(leds[i],CRGB(0,0,0),16);

    if(random16()&lt;50){
        fadeTowardColor(leds[i], CRGB(255,255,255), 255);
    }
  }
}

void nblendU8TowardU8( uint8_t&amp; cur, const uint8_t target, uint8_t amount)
{
  if( cur == target) return;

  if( cur &lt; target ) {
    uint8_t delta = target - cur;
    delta = scale8_video( delta, amount);
    cur += delta;
  } else {
    uint8_t delta = cur - target;
    delta = scale8_video( delta, amount);
    cur -= delta;
  }
}

// Blend one CRGB color toward another CRGB color by a given amount.
// Blending is linear, and done in the RGB color space.
// This function modifies 'cur' in place.
CRGB fadeTowardColor( CRGB&amp; cur, const CRGB&amp; target, uint8_t amount)
{
  nblendU8TowardU8( cur.red,   target.red,   amount);
  nblendU8TowardU8( cur.green, target.green, amount);
  nblendU8TowardU8( cur.blue,  target.blue,  amount);
  return cur;
}
&lt;/code&gt;&lt;/pre&gt;



</FastLED.h></code></pre></div><ul class="post__social"><li><a href="https://www.facebook.com/sharer/sharer.php?u=https://jon-e.net/blog/https://jon-e.net/blog/2018/10/18/northern-lights/" target="_blank"><i class="fa fa-facebook"></i></a></li><li><a href="https://twitter.com/intent/tweet?&text=Northern Lights+https://jon-e.net/blog/https://jon-e.net/blog/2018/10/18/northern-lights/+by+Jonny Saunders" target="_blank"><i class="fa fa-twitter"></i></a></li><li><a href="https://plus.google.com/share?url=https://jon-e.net/blog/https://jon-e.net/blog/2018/10/18/northern-lights/" target="_blank"><i class="fa fa-google-plus"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?mini=true&source=Northern Lights&summary=&url=https://jon-e.net/blog/https://jon-e.net/blog/2018/10/18/northern-lights/" target="_blank"><i class="fa fa-linkedin"></i></a></li><li><a href="https://www.stumbleupon.com/badge/?url=https://jon-e.net/blog/https://jon-e.net/blog/2018/10/18/northern-lights/" target="_blank"><i class="fa fa-stumbleupon"></i></a></li><li><a href="https://www.reddit.com/submit?url=https://jon-e.net/blog/https://jon-e.net/blog/2018/10/18/northern-lights/" target="_blank"><i class="fa fa-reddit-alien"></i></a></li><li><a href="https://www.tumblr.com/share/link?url=https://jon-e.net/blog/https://jon-e.net/blog/2018/10/18/northern-lights/" target="_blank"><i class="fa fa-tumblr"></i></a></li><li><a href="https://www.pinterest.com/pin/create/link/?description=&media=https://jon-e.net/blog/assets/images/nlight.png&url=https://jon-e.net/blog/https://jon-e.net/blog/2018/10/18/northern-lights/" target="_blank"><i class="fa fa-pinterest"></i></a></li></ul></div></div><div class="section-padding--none"><div class="grid"><hr class="sep"/></div></div><div class="section-padding"><div class="grid-small"> <span class="post__author">Posted by <a href="http://jon-e.net" title="More By Jonny Saunders">Jonny Saunders</a></span><p class="post__bio">bad at programming and neuroscience in beautiful Oregon.</p></div></div></article></div><section class="related section-padding"><div class="grid-xlarge"><h2 class="related__title">Related</h2><div class="related__container"><article class="related__post"> <a class="related__link" href="https://jon-e.net/blog/https://jon-e.net/blog/2018/10/18/northern-lights/"><figure class="related__img"> <img src="https://jon-e.net/blog/assets/images/nlight.png" alt="Northern Lights"/></figure><div><h2 class="related__text">Northern Lights</h2></div></a></article></div></div></section></main><footer class="footer section-padding"><div class="grid"><div class="subscribe" id="subscribe"><div class="subscribe__container"> <span class="subscribe__title">Subscribe</span><p class="subscribe__text">Get a weekly email of posts Iâ€™ve added to the site.</p><form method="POST" action="&amp;c=?" id="mc-signup" name="mc-embedded-subscribe-form" novalidate><div style="position: absolute; left: -5000px;" aria-hidden="true"> <input type="text" name="" tabindex="-1" value=""></div><div class="form-group"> <input id="mce-EMAIL" type="email" name="EMAIL" placeholder="Email Address"></div><div class="form__btn"> <input id="mc-submit" type="submit" value="Sign Up" name="subscribe"></div></form><p class="subscribe__error hidden"></p></div></div><hr class="sep--white"/><div class="footer__container"><ul class="footer__tags"><li><a class="footer__link" href="/tag/art">Art</a></li></ul><ul class="footer__social"><li><a href="https://twitter.com/json_durs" target="_blank"><i class="fa fa-twitter"></i></a></li><li><a href="https://github.com/sneakers_the_rat" target="_blank"><i class="fa fa-github"></i></a></li></ul></div></div></footer><section class="contact popup"><div class="popup__close"><div class="popup__exit"></div></div><div class="contact__container popup__container"><div class="contact__img"><figure class="absolute-bg" style="background-image: url(https://jon-e.net/blog);"></figure></div><div class="contact__content"><div class="contact__mast section-padding--half"><div class="grid"><h2>Contact</h2></div></div><div class="section-padding--none"><hr class="sep"/></div><div class="contact__form section-padding--half"><div class="grid-xlarge"> <form id="form" class="form" action="" method="POST"><div class="form__subcontainer"><div> <label for="form-first-name">First Name</label> <input type="text" name="first-name" id="form-first-name" required></div><div> <label for="form-last-name">Last Name</label> <input type="text" name="last-name" id="form-last-name" required></div></div><div> <label for="form-email">E-Mail</label> <input type="email" name="email" id="form-email" required></div><div> <label for="form-message">Message</label> <textarea name="message" id="form-message" rows="3"></textarea></div><div class="form__submit"><div class="form__btn"> <input type="submit" value="Send"></div></div><p class="form__message"></p></form></div></div></div></div></section><script src="https://jon-e.net/blog/assets/js/app.min.js"></script></body></html>
  